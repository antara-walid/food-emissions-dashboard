<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Foodprint - Dashboard √âmissions</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <h1 class="nav-title">üå± Foodprint</h1>
        <div class="nav-links">
            <button class="nav-btn" data-target="page-landing">Accueil</button>
            <button class="nav-btn active" data-target="page-dashboard">√âmissions Globales</button>
            <button class="nav-btn" data-target="page-food">Impact Alimentaire</button>
        </div>
    </nav>

    <section id="page-landing" class="page-section" style="display: none;">
        <div class="glass-card">
            <h2>Explorez l'Empreinte Carbone<br>de Votre Assiette</h2>
            <h3 class="landing-subtitle">Comprendre l'Impact de nos Syst√®mes Alimentaires</h3>
            
            <p class="landing-description">
                Ce projet permet d'explorer l'impact des syst√®mes alimentaires sur les √©missions de gaz √† effet de serre (GES). L'objectif est de r√©aliser une application interactive permettant de d√©construire l'empreinte carbone de diff√©rents aliments (viandes, c√©r√©ales, laitiers, etc.) √† travers leur cycle de vie complet.
            </p>
            
            <button class="glass-btn" onclick="document.querySelector('[data-target=\'page-dashboard\']').click()">
                Commencer l'Exploration
            </button>
        </div>
    </section>

    <section id="page-dashboard" class="page-section fullscreen-dashboard">
        <div class="dashboard-grid">
            <div class="grid-top">
                <div class="chart-card map-card">
                    <div id="map-container"></div>
                    
                    <div class="floating-controls">
                        <div class="control-row">
                            <label for="metricSelect">M√©trique :</label>
                            <select id="metricSelect">
                                <option value="Total (tonnes CO‚ÇÇeq)">Total (t CO‚ÇÇeq)</option>
                                <option value="Part des √©missions totales (%)">Part (%)</option>
                            </select>
                        </div>
                        <div class="control-row-slider">
                            <div class="slider-header">
                                <label for="yearSlider">Ann√©e :</label>
                                <span id="yearDisplay">2009</span>
                            </div>
                            <input type="range" id="yearSlider" min="1990" max="2015" value="2009" step="1">
                        </div>
                    </div>
                    <div id="tooltip"></div>
                </div>

                <div class="side-charts">
                    <div class="chart-card half-height">
                        <div id="bar-chart-container"></div>
                    </div>
                    <div class="chart-card half-height">
                        <div id="line-chart-container"></div>
                    </div>
                </div>
            </div>

            <div class="grid-bottom chart-card">
                <div id="stacked-chart-container"></div>
            </div>
        </div>
    </section>

    <section id="page-food" class="page-section" style="display: none;">
        <div class="food-section">
            <h2 class="food-title">Zoom sur l'assiette : Quel aliment pollue le plus ?</h2>
            <div class="food-charts-wrapper">
                <div id="food-bar-container"></div>
                <div id="food-donut-wrapper">
                    <div id="food-donut-container"></div>
                    <div id="food-donut-legend"></div>
                </div>
            </div>
        </div>
    </section>

    <script src="stackedChart.js"></script>
    <script src="lineChart.js"></script>
    <script src="barChart.js"></script>
    <script src="map.js"></script>
    <script src="foodCharts.js"></script>
    <script src="main.js"></script>

    <script>
        // --- 1. GESTION DES ONGLETS DE NAVIGATION ---
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                document.querySelectorAll('.page-section').forEach(p => p.style.display = 'none');
                
                const targetId = this.getAttribute('data-target');
                const targetElement = document.getElementById(targetId);
                
                // LA CORRECTION EST ICI : On prot√®ge le centrage de l'accueil
                if (targetId === 'page-landing') {
                    targetElement.style.display = 'flex'; 
                } else {
                    targetElement.style.display = 'block';
                }

                if (targetId === 'page-dashboard' && typeof updateAllCharts === 'function') {
                    updateAllCharts();
                } else if (targetId === 'page-food' && typeof drawFoodCharts === 'function') {
                    drawFoodCharts();
                }
            });
        });

        // --- 2. GESTION DES CONTR√îLES (M√©trique & Ann√©e) ---
        const selectElement = document.getElementById('metricSelect');
        const yearSlider = document.getElementById('yearSlider');
        const yearDisplay = document.getElementById('yearDisplay');

        if(selectElement) {
            selectElement.addEventListener('change', function() {
                if (typeof selectedMetric !== 'undefined') {
                    selectedMetric = this.value;
                    if (typeof updateAllCharts === 'function') updateAllCharts();
                }
            });
        }

        if(yearSlider && yearDisplay) {
            yearSlider.addEventListener('input', function() {
                yearDisplay.textContent = this.value;
                
                if (typeof selectedYear !== 'undefined') {
                    selectedYear = parseInt(this.value);
                } else if (typeof currentYear !== 'undefined') {
                    currentYear = parseInt(this.value);
                }

                if (typeof updateAllCharts === 'function') {
                    updateAllCharts();
                }
            });
        }

        // --- 3. GESTION DE LA TAILLE D'√âCRAN ---
        window.addEventListener('resize', () => {
            if (document.getElementById('page-dashboard').style.display !== 'none') {
                if (typeof updateAllCharts === 'function') updateAllCharts();
            }
        });

        // --- 4. INITIALISATION AU D√âMARRAGE ---
        document.addEventListener('DOMContentLoaded', () => {
            // Force l'affichage de l'onglet Accueil par d√©faut au lancement
            document.getElementById('page-landing').style.display = 'flex';
            document.getElementById('page-food').style.display = 'none';
            document.getElementById('page-dashboard').style.display = 'none';
            
            // Met le bon bouton en surbrillance
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-target="page-landing"]').classList.add('active');
        });
    </script>
</body>
</html>